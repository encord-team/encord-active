from pathlib import Path
from typing import Optional

import streamlit as st
from streamlit.components.v1 import html

from encord_active.lib.constants import DOCS_URL, SLACK_INVITE_URL

SLACK_ICON = """<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.39688 2C5.73438 2 5.19844 2.5375 5.19844 3.2C5.19844 3.51719 5.325 3.82344 5.54844 4.04844C5.77344 4.27344 6.07813 4.4 6.39688 4.4H7.59531V3.2C7.59531 2.53906 7.05938 2.00156 6.39688 2ZM6.39688 5.2H3.19844C2.53594 5.2 2 5.7375 2 6.4C2 7.0625 2.5375 7.6 3.19844 7.6H6.39531C7.05781 7.6 7.59375 7.0625 7.59375 6.4C7.59531 5.7375 7.05781 5.2 6.39688 5.2ZM9.59375 7.6C10.2563 7.6 10.7938 7.0625 10.7922 6.4V3.2C10.7922 2.5375 10.2563 2 9.59375 2C8.93125 2 8.39531 2.5375 8.39531 3.2V6.4C8.39531 7.06406 8.93125 7.6 9.59375 7.6V7.6ZM13.9906 6.4C13.9906 5.7375 13.4531 5.2 12.7922 5.2C12.1313 5.2 11.5938 5.7375 11.5938 6.4V7.6H12.7922C13.4531 7.6 13.9906 7.0625 13.9906 6.4V6.4ZM12.7906 8.4H9.59375C8.93125 8.4 8.39531 8.9375 8.39531 9.6C8.39531 9.91719 8.52188 10.2234 8.74531 10.4484C8.97031 10.6734 9.275 10.8 9.59375 10.8H12.7906C13.4531 10.8 13.9891 10.2625 13.9891 9.6C13.9906 8.9375 13.4531 8.40156 12.7906 8.4V8.4ZM9.59375 11.6H8.39531V12.8C8.39531 13.4625 8.93281 14 9.59375 14C10.2563 14 10.7938 13.4625 10.7922 12.8C10.7938 12.1375 10.2563 11.6016 9.59375 11.6ZM6.39688 8.4C5.73438 8.4 5.19844 8.9375 5.19844 9.6V12.8C5.19844 13.4625 5.73594 14 6.39688 14C7.05938 14 7.59688 13.4625 7.59531 12.8V9.6C7.59531 9.28281 7.46875 8.97656 7.24531 8.75156C7.02031 8.52656 6.71406 8.4 6.39688 8.4ZM2 9.6C2 9.91719 2.12656 10.2234 2.35 10.4484C2.575 10.6734 2.87969 10.8 3.19844 10.8C3.86094 10.8 4.39844 10.2625 4.39688 9.6V8.4H3.19844C2.5375 8.4 2 8.9375 2 9.6V9.6Z" fill="#373737"/>
</svg>"""
DOCS_ICON = """<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13 1H3C2.72344 1 2.5 1.22344 2.5 1.5V14.5C2.5 14.7766 2.72344 15 3 15H13C13.2766 15 13.5 14.7766 13.5 14.5V1.5C13.5 1.22344 13.2766 1 13 1ZM12.375 13.875H3.625V10.7344H5.15469C5.33594 11.2469 5.65469 11.7078 6.07812 12.0578C6.61719 12.5031 7.3 12.75 8 12.75C8.7 12.75 9.38281 12.5047 9.92188 12.0578C10.3453 11.7078 10.6641 11.2469 10.8453 10.7344H12.375V9.75H10.0562L9.975 10.1359C9.7875 11.0703 8.95625 11.75 8 11.75C7.04375 11.75 6.2125 11.0703 6.02344 10.1359L5.94219 9.75H3.625V2.125H12.375V13.875ZM5 5.32812H11C11.0688 5.32812 11.125 5.27188 11.125 5.20312V4.45312C11.125 4.38437 11.0688 4.32812 11 4.32812H5C4.93125 4.32812 4.875 4.38437 4.875 4.45312V5.20312C4.875 5.27188 4.93125 5.32812 5 5.32812ZM5 7.82812H11C11.0688 7.82812 11.125 7.77188 11.125 7.70312V6.95312C11.125 6.88437 11.0688 6.82812 11 6.82812H5C4.93125 6.82812 4.875 6.88437 4.875 6.95312V7.70312C4.875 7.77188 4.93125 7.82812 5 7.82812Z" fill="#373737"/>
</svg>"""


def link(text: str, href: str, icon: Optional[str] = None):
    return f'<a style="display: flex; gap: 0.5rem; align-items: center; text-decoration: none; color: unset; font-weight: 600" href={href}>{icon if icon else ""} {text}</a>'


def render_help():
    with st.sidebar:
        html((Path(__file__).parent / "help.html").read_text(encoding="utf-8"), height=0, width=0)
        st.markdown(
            f"""
            <div style="display: flex; flex-direction: column; padding: 1rem">
                <span style="font-size: 1.2rem">Need help?</span>
                {link("Join our Slack community", SLACK_INVITE_URL, SLACK_ICON)}
                {link("Documentation", DOCS_URL, DOCS_ICON)}
            </div>""",
            unsafe_allow_html=True,
        )
