---
title: KITTI Bounding Boxes
sidebar_position: 2
---

:::caution

This works for bounding boxes only.

:::

:::caution

Every time you run any of these importers, previously imported predictions will be overwritten!
Make sure to [version your projects][project-versioning] if you want to be able to go back to previous model iterations.

:::

If you have KITTI predictions stored in CSV files, there is a utility function to import the predictions from those files.
For this, the files must be associated with one image each and their file names must contain the `data_hash` of the associated image.

The file structure needs to be as follows:

```
labels_root
├── labels
│   ├── aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee__whatever_you_may_need.txt
│   ├── ...
│   └── aaaaaaaa-bbbb-cccc-dddd-ffffffffffff__whatever_you_may_need.csv
└── ontology_label_map.json
```

That is, a root directory with two components:

1. A subdirectory named "labels" that contains text files with names that start with the `data_hash` followed by two underscores
2. A json file which maps class names to Encord ontology classes

We cover the two components below.

### Text File Format

The KITTI importer supports the format described [here](https://docs.nvidia.com/tao/archive/tlt-20/tlt-user-guide/text/preparing_data_input.html#label-files) with the addition of an additional column corresponding to the model confidence.

An example:

```
car 0.00 0 0.00 587.01 173.33 614.12 200.12 0.00 0.00 0.00 0.00 0.00 0.00 0.00 97.85
cyclist 0.00 0 0.00 665.45 160.00 717.93 217.99 0.00 0.00 0.00 0.00 0.00 0.00 0.00 32.65
pedestrian 0.00 0 0.00 423.17 173.67 433.17 224.03 0.00 0.00 0.00 0.00 0.00 0.00 0.00 3.183
```

Columns are:

- `class_name`: str
- ~~`truncation`: float~~ ignored
- ~~`occlusion`: int~~ ignored
- ~~`alpha`: float~~ ignored
- `xmin`: float
- `ymin`: float
- `xmax`: float
- `ymax`: float
- ~~`height`: float~~ ignored
- ~~`width`: float~~ ignored
- ~~`length`: float~~ ignored
- ~~`location_x`: float~~ ignored
- ~~`location_y`: float~~ ignored
- ~~`location_z`: float~~ ignored
- ~~`rotation_y`: float~~ ignored
- `confidence`: float

Note, the ignored items need to be there but will be ignored.

### The JSON Class Map

The JSON class map needs to follow the following structure:

```json
{
  # featureNodeHash: class_name
  "OTk2MzM3": "pedestrian",
  "NzYyMjcx": "cyclist",
  "Nzg2ODEx": "car"
}
```

The keys should correspond to the `featureNodeHash` of a bounding box object in the project ontology.
To list the available hashes from your project, you can do this in your script:

```python
from pathlib import Path

import yaml
from encord import EncordUserClient

data_dir = Path("/path/to/the/data")
meta = yaml.safe_load((data_dir / "project_meta.yaml").read_text())
private_key = Path(meta["ssh_key_path"]).read_text()

client = EncordUserClient.create_with_ssh_private_key(private_key)
project = client.get_project(project_hash=meta["project_hash"])

# NB: Remember to include the first code snippet on this page.
print({o["featureNodeHash"]: o["name"] for o in project.ontology["objects"]})
# Outputs somtihing similar to
# {'OTk2MzM3': 'Pedestrian', 'NzYyMjcx': 'Cyclist', 'Nzg2ODEx': 'Car'}
```

The values of the JSON file should be the values that can appear in the first column of text files described above.

### Importing the Predictions

To import the predictions, you do the following

```python
import json

from encord_active.lib.model_predictions.importers import import_KITTI_labels
from encord_active.lib.model_predictions.writer import PredictionWriter

# highlight-next-line
predictions_root = Path("/path/to/your/predictions")
object_map = json.loads((predictions_root / "ontology_label_map.json").read_text())

with PredictionWriter(cache_dir=data_dir, project=project, custom_object_map=object_map) as writer:
    import_KITTI_labels(project, data_root=predictions_root, prediction_writer=writer)
```

[project-versioning]: ../../user-guide/versioning
